<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data cleaning and wrangling with cleanEHR • rOpenSci: cleanEHR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- ropensci --><link href="../ropensci.css" rel="stylesheet">
<meta property="og:title" content="Data cleaning and wrangling with cleanEHR">
<meta property="og:description" content="cleanEHR">
<meta name="twitter:card" content="summary">
<!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a href="https://ropensci.org"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
        <a class="navbar-brand" href="../index.html"><i>cleanEHR <small>v1.0</small></i></a>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cchic_overview.html">Introduction to CCHIC critical care data</a>
    </li>
    <li>
      <a href="../articles/data_clean.html">Data cleaning and wrangling with cleanEHR</a>
    </li>
  </ul>
</li>
        <li>
  <a href="https://github.com/ropensci/cleanEHR/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right docsearch" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Data cleaning and wrangling with cleanEHR</h1>
                        <h4 class="author">David Perez Suarez &amp; Sinan Shi</h4>
            
            <h4 class="date">2021-07-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/cleanEHR/blob/master/vignettes/data_clean.Rmd"><code>vignettes/data_clean.Rmd</code></a></small>
      <div class="hidden name"><code>data_clean.Rmd</code></div>

    </div>

    
    
<div id="preparation" class="section level1">
<h1 class="hasAnchor">
<a href="#preparation" class="anchor"></a>Preparation</h1>
<p><a href="https://CRAN.R-project.org/package=data.table">data.table</a> package is the backbone of cleanEHR package. You can find in the above link some useful information and tutorial, if you are not familiar with <code>data.table</code>.</p>
<div id="load-data" class="section level3">
<h3 class="hasAnchor">
<a href="#load-data" class="anchor"></a>Load data</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/cleanEHR">cleanEHR</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"sample_ccd"</span><span class="op">)</span></code></pre></div>
</div>
<div id="inspect-individual-episode" class="section level3">
<h3 class="hasAnchor">
<a href="#inspect-individual-episode" class="anchor"></a>Inspect individual episode</h3>
<p>There are 263 fields which covers patient demographics, physiology, laboratory, and medication information. Each field has 2 labels, NHIC code and short name. There is a function <code><a href="../reference/lookup.items.html">lookup.items()</a></code> to look up the fields you need. <code><a href="../reference/lookup.items.html">lookup.items()</a></code> function is case insensitive and allows fuzzy search.</p>
<pre><code># searching for heart rate
lookup.items('heart') # fuzzy search

+-------------------+--------------+--------------+--------+-------------+
|     NHIC.Code     |  Short.Name  |  Long.Name   |  Unit  |  Data.type  |
+===================+==============+==============+========+=============+
| NIHR_HIC_ICU_0108 |    h_rate    |  Heart rate  |  bpm   |   numeric   |
+-------------------+--------------+--------------+--------+-------------+
| NIHR_HIC_ICU_0109 |   h_rhythm   | Heart rhythm |  N/A   |    list     |
+-------------------+--------------+--------------+--------+-------------+
</code></pre>
</div>
</div>
<div id="non-longitudinal-data" class="section level1">
<h1 class="hasAnchor">
<a href="#non-longitudinal-data" class="anchor"></a>Non-longitudinal Data</h1>
<p><code><a href="../reference/ccd_demographic_table.html">ccd_demographic_table()</a></code> can generate a <code>data.table</code> that contains all the non-longitudinal variables. A demonstration of how to do some work on a subset of data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># contains all the 1D fields i.e. non-longitudinal</span>
<span class="va">tb1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ccd_demographic_table.html">ccd_demographic_table</a></span><span class="op">(</span><span class="va">ccd</span><span class="op">)</span>

<span class="co"># filter out all dead patient. (All patients are dead in the dataset.)</span>
<span class="va">tb1</span> <span class="op">&lt;-</span> <span class="va">tb1</span><span class="op">[</span><span class="va">DIS</span><span class="op">==</span><span class="st">"D"</span><span class="op">]</span>

<span class="co"># subset variables we want (ARSD = Advanced respiratory support days,</span>
<span class="co"># apache_prob = APACHE II probability)</span>
<span class="va">tb</span> <span class="op">&lt;-</span> <span class="va">tb1</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SEX"</span>, <span class="st">"ARSD"</span>, <span class="st">"apache_prob"</span><span class="op">)</span>, with<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span>
<span class="va">tb</span> <span class="op">&lt;-</span> <span class="va">tb</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">apache_prob</span><span class="op">)</span><span class="op">]</span>

<span class="co"># plot</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">tb</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">apache_prob</span>, y<span class="op">=</span><span class="va">ARSD</span>, color<span class="op">=</span><span class="va">SEX</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="data_clean_files/figure-html/unnamed-chunk-2-1.png" width="600px"></p>
</div>
<div id="longitudinal-data" class="section level1">
<h1 class="hasAnchor">
<a href="#longitudinal-data" class="anchor"></a>Longitudinal data</h1>
<div id="longitudinal-table-structure-cctable" class="section level2">
<h2 class="hasAnchor">
<a href="#longitudinal-table-structure-cctable" class="anchor"></a>Longitudinal table structure: <code>ccTable</code>
</h2>
<p>To deal with longitudinal data, we need to first to transform it into a table format. cleanEHR provides a refclass <code>ccTable</code>. There are several key components in the <code>ccTable</code> structure.</p>
<ul>
<li>
<code>torigin</code>: the <code>ccRecord</code> dataset will be converted into a table format, where each row is a data point and each column is a field and pivoted by <code>time</code>, <code>site</code>, and <code>eipisode_id</code>.</li>
<li>
<code>tclean</code>: Same structure like the <code>torigin</code> but the values are modified with the cleaning process.</li>
<li>filters: <code>filter_range</code>, <code>filter_categories</code>, <code>filter_nodata</code>, <code>filter_missingness</code>.</li>
<li>imputation: filling missing data.</li>
</ul>
<div id="create-a-cctable" class="section level3">
<h3 class="hasAnchor">
<a href="#create-a-cctable" class="anchor"></a>Create a <code>cctable</code>
</h3>
<p>First we need to prepare a simple YAML configuration file. YAML is a human freindly data serialization standard, see <a href="http://yaml.org/">YAML</a>. The first level item is CCHIC code, see <code><a href="../reference/lookup.items.html">lookup.items()</a></code>. We suggest users to write the short name and long name (dataItem) to avoid confusion, though the both names will not be taken into account in the process. We selected three items, heart rate (longitudinal), Systolic arterial blood pressure (longitudinal), and sex (non-longitudinal).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># To prepare a YAML configuration file like this. You write the following text</span>
<span class="co"># in a YAML file. </span>
<span class="va">conf</span> <span class="op">&lt;-</span> <span class="st">"
NIHR_HIC_ICU_0108:
  shortName: hrate
NIHR_HIC_ICU_0112:
  shortName: bp_sys_a
  dataItem: Systolic Arterial blood pressure - Art BPSystolic Arterial blood pressure
NIHR_HIC_ICU_0093:
   shortName: sex
"</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/viking/r-yaml/">yaml</a></span><span class="op">)</span>
<span class="va">conf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/yaml/man/yaml.load.html">yaml.load</a></span><span class="op">(</span><span class="va">conf</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># conf is the full path of the YAML configuration.</span>
<span class="va">tb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_cctable.html">create_cctable</a></span><span class="op">(</span><span class="va">ccd</span>, <span class="va">conf</span>, freq<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tb</span><span class="op">$</span><span class="va">torigin</span><span class="op">)</span> <span class="co"># the table</span></code></pre></div>
<pre><code>##       time NIHR_HIC_ICU_0108 NIHR_HIC_ICU_0112 NIHR_HIC_ICU_0093        site
##    1:    0                64                NA                 F pseudo_site
##    2:    1                71                NA                 F pseudo_site
##    3:    2                71                NA                 F pseudo_site
##    4:    3                80                NA                 F pseudo_site
##    5:    4                NA                NA                 F pseudo_site
##   ---                                                                       
## 7932:  690                NA                NA                 M pseudo_site
## 7933:  691                88                NA                 M pseudo_site
## 7934:  692                NA                NA                 M pseudo_site
## 7935:  693                NA                NA                 M pseudo_site
## 7936:  694                NA                NA                 M pseudo_site
##       episode_id NIHR_HIC_ICU_0112.meta
##    1:          1                     NA
##    2:          1                     NA
##    3:          1                     NA
##    4:          1                     NA
##    5:          1                     NA
##   ---                                  
## 7932:          9                     NA
## 7933:          9                     NA
## 7934:          9                     NA
## 7935:          9                     NA
## 7936:          9                     NA</code></pre>
<p>In this table we can find the following columns,</p>
<ul>
<li>time: number of hours from the unit admission. Since we set the <code>freq</code>=1, the cadence between rows is always 1 hour.</li>
<li>site, episode_id: combine these two columns will give you a unique admission.</li>
<li>fields: three selected fields.</li>
<li>extra fields: depending on the variable we choose, some extra information are given.</li>
</ul>
</div>
<div id="get-the-mean-heart-rate-of-each-patient-" class="section level3">
<h3 class="hasAnchor">
<a href="#get-the-mean-heart-rate-of-each-patient-" class="anchor"></a>Get the mean heart rate of each patient.</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tb</span><span class="op">$</span><span class="va">tclean</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">NIHR_HIC_ICU_0108</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"site"</span>, <span class="st">"episode_id"</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<pre><code>##            site episode_id        V1
##  1: pseudo_site          1  73.00000
##  2: pseudo_site         10  80.70370
##  3: pseudo_site         11  87.57143
##  4: pseudo_site         12  95.61667
##  5: pseudo_site         13 130.09091
##  6: pseudo_site         14 105.70833
##  7: pseudo_site         15 117.50000
##  8: pseudo_site         16 105.20727
##  9: pseudo_site         17  88.40719
## 10: pseudo_site         18  76.52222
## 11: pseudo_site         19  89.50845
## 12: pseudo_site          2 103.14615
## 13: pseudo_site         20  72.02439
## 14: pseudo_site         21  95.60274
## 15: pseudo_site         22 100.34416
## 16: pseudo_site         23  98.48810
## 17: pseudo_site         24 123.16566
## 18: pseudo_site         25  86.85714
## 19: pseudo_site         26  87.63636
## 20: pseudo_site         27 121.37143
## 21: pseudo_site         28 111.96195
## 22: pseudo_site         29  75.40000
## 23: pseudo_site          3  87.31818
## 24: pseudo_site         30  53.00000
## 25: pseudo_site          4 114.60386
## 26: pseudo_site          5 102.20000
## 27: pseudo_site          6 107.87650
## 28: pseudo_site          7  70.40595
## 29: pseudo_site          8 109.84091
## 30: pseudo_site          9  78.71179
##            site episode_id        V1</code></pre>
</div>
</div>
</div>
<div id="data-cleaning-with-cctable" class="section level1">
<h1 class="hasAnchor">
<a href="#data-cleaning-with-cctable" class="anchor"></a>Data cleaning with <code>ccTable</code>
</h1>
<div id="numerical-range-filter" class="section level2">
<h2 class="hasAnchor">
<a href="#numerical-range-filter" class="anchor"></a>Numerical range filter</h2>
<p>The numerical range filter can only be applied on variables. We envisaged three different cases for the numerical ranges – values that are impossible, e.g.  negative heart rate; possible but unlikely, e.g. heart rate of 200; within a normal range. The filter will label all these scenarios using “red”, “amber”, “green” respectively. The definition of these ranges can be configured by users based on their judgement and the purpose of research. Note, from “red” to “green”, the next range must be a subset of the previous range.</p>
<p>In the following section, we would like to apply a range filter to heart rate by modifying the previous YAML configuration file.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">conf</span> <span class="op">&lt;-</span> <span class="st">"NIHR_HIC_ICU_0108:
  shortName: h_rate
  dataItem: Heart rate
  range:
    labels:
      red: (0, 300)
      amber: (11, 150]
      green: (50, 100]
    apply: drop_entry
NIHR_HIC_ICU_0112:
  shortName: bp_sys_a
  dataItem: Systolic Arterial blood pressure - Art BPSystolic Arterial blood pressure
NIHR_HIC_ICU_0093:
   shortName: sex
   category:
      M: male
      F: female
      m: male
      f: female
"</span>
<span class="va">conf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/yaml/man/yaml.load.html">yaml.load</a></span><span class="op">(</span><span class="va">conf</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_cctable.html">create_cctable</a></span><span class="op">(</span><span class="va">ccd</span>, <span class="va">conf</span>, freq<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="va">tb</span><span class="op">$</span><span class="fu">filter_range</span><span class="op">(</span><span class="st">"amber"</span><span class="op">)</span> <span class="co"># chose only the entry with amber</span>
<span class="va">tb</span><span class="op">$</span><span class="fu">apply_filters</span><span class="op">(</span><span class="op">)</span> <span class="co"># apply the filter to the clean table</span></code></pre></div>
<p>Now let’s see the effect on the cleaned data <code>tclean</code></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cptb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">tb</span><span class="op">$</span><span class="va">torigin</span>, data<span class="op">=</span><span class="st">"origin"</span><span class="op">)</span>, 
              <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">tb</span><span class="op">$</span><span class="va">tclean</span>, data<span class="op">=</span><span class="st">"clean"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">cptb</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">time</span>, y<span class="op">=</span><span class="va">NIHR_HIC_ICU_0108</span>, color<span class="op">=</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">episode_id</span>, scales<span class="op">=</span><span class="st">"free_x"</span><span class="op">)</span></code></pre></div>
<p><img src="data_clean_files/figure-html/unnamed-chunk-8-1.png" width="700px"></p>
<p>In the case of changing the filter range from amber to green,</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#tb$reset() # reset the all the filters first.</span>
<span class="va">tb</span><span class="op">$</span><span class="fu">filter_range</span><span class="op">(</span><span class="st">"green"</span><span class="op">)</span>
<span class="va">tb</span><span class="op">$</span><span class="fu">apply_filters</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cptb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">tb</span><span class="op">$</span><span class="va">torigin</span>, data<span class="op">=</span><span class="st">"origin"</span><span class="op">)</span>, 
              <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">tb</span><span class="op">$</span><span class="va">tclean</span>, data<span class="op">=</span><span class="st">"clean"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">cptb</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">time</span>, y<span class="op">=</span><span class="va">NIHR_HIC_ICU_0108</span>, color<span class="op">=</span><span class="va">data</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">episode_id</span>, scales<span class="op">=</span><span class="st">"free_x"</span><span class="op">)</span></code></pre></div>
<p><img src="data_clean_files/figure-html/unnamed-chunk-10-1.png" width="700px"></p>
</div>
<div id="categorical-data-filter" class="section level2">
<h2 class="hasAnchor">
<a href="#categorical-data-filter" class="anchor"></a>Categorical data filter</h2>
<p>The purpose of categorical data filter is to remove the unexpected categorical data. We can extend the previous configuration file as such,</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">conf</span> <span class="op">&lt;-</span> <span class="st">"NIHR_HIC_ICU_0108:
  shortName: h_rate
  dataItem: Heart rate
NIHR_HIC_ICU_0112:
  shortName: bp_sys_a
  dataItem: Systolic Arterial blood pressure - Art BPSystolic Arterial blood pressure
NIHR_HIC_ICU_0093:
   shortName: sex
   category:
    levels:
      M: male
      F: female
      m: male
      f: female
    apply: drop_entry
"</span>
<span class="va">conf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/yaml/man/yaml.load.html">yaml.load</a></span><span class="op">(</span><span class="va">conf</span><span class="op">)</span>

<span class="co"># Try to modify the original data</span>
<span class="va">tb</span><span class="op">$</span><span class="va">torigin</span><span class="op">$</span><span class="va">NIHR_HIC_ICU_0093</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"ERROR"</span>

<span class="va">tb</span><span class="op">$</span><span class="fu">reload_conf</span><span class="op">(</span><span class="va">conf</span><span class="op">)</span>  <span class="co"># change configuration file</span>
<span class="va">tb</span><span class="op">$</span><span class="fu">filter_categories</span><span class="op">(</span><span class="op">)</span> 
<span class="va">tb</span><span class="op">$</span><span class="fu">apply_filters</span><span class="op">(</span><span class="op">)</span> </code></pre></div>
<p>There is one error gender introduced in the sex field. After the filtering process, the error entry is substitute by NA.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">tb</span><span class="op">$</span><span class="va">torigin</span><span class="op">$</span><span class="va">NIHR_HIC_ICU_0093</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "ERROR" "F"     "M"</code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">tb</span><span class="op">$</span><span class="va">tclean</span><span class="op">$</span><span class="va">NIHR_HIC_ICU_0093</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] NA  "F" "M"</code></pre>
</div>
<div id="missingness-filter" class="section level2">
<h2 class="hasAnchor">
<a href="#missingness-filter" class="anchor"></a>Missingness filter</h2>
<p>In some cases, we wish to exclude episodes where the data is too scarce. There are three components in the missingness filter. In the following example, we arbitrarily name the filter “daily”. We gave 24 hours interval and 70% accepting rate. It is to say in any 24 hours interval, if the heart rate missing rate is higher than 30%, we will exclude the entire episode. Note, the unit <code>labels: daily: 24</code> number of rows instead of hours. It represents 24 hours because the cadence of the <code>ccTable</code> is 1 hour.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">conf</span> <span class="op">&lt;-</span> <span class="st">"NIHR_HIC_ICU_0108:
  shortName: h_rate
  dataItem: Heart rate
  missingness:
    labels:
      daily: 24
    accept_2d:
      daily: 70
    apply: drop_episode
NIHR_HIC_ICU_0112:
  shortName: bp_sys_a
  dataItem: Systolic Arterial blood pressure - Art BPSystolic Arterial blood pressure
NIHR_HIC_ICU_0093:
   shortName: sex
"</span>
<span class="va">conf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/yaml/man/yaml.load.html">yaml.load</a></span><span class="op">(</span><span class="va">conf</span><span class="op">)</span>

<span class="va">tb</span><span class="op">$</span><span class="fu">reload_conf</span><span class="op">(</span><span class="va">conf</span><span class="op">)</span>  <span class="co"># change configuration file</span>
<span class="va">tb</span><span class="op">$</span><span class="fu">filter_missingness</span><span class="op">(</span><span class="op">)</span> 
<span class="va">tb</span><span class="op">$</span><span class="fu">apply_filters</span><span class="op">(</span><span class="op">)</span>

<span class="co"># episodes in the original data table </span>
<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tb</span><span class="op">$</span><span class="va">torigin</span><span class="op">$</span><span class="va">site</span>, <span class="va">tb</span><span class="op">$</span><span class="va">torigin</span><span class="op">$</span><span class="va">episode_id</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "pseudo_site 1"  "pseudo_site 10" "pseudo_site 11" "pseudo_site 12"
##  [5] "pseudo_site 13" "pseudo_site 14" "pseudo_site 15" "pseudo_site 16"
##  [9] "pseudo_site 17" "pseudo_site 18" "pseudo_site 19" "pseudo_site 2" 
## [13] "pseudo_site 20" "pseudo_site 21" "pseudo_site 22" "pseudo_site 23"
## [17] "pseudo_site 24" "pseudo_site 25" "pseudo_site 26" "pseudo_site 27"
## [21] "pseudo_site 28" "pseudo_site 29" "pseudo_site 3"  "pseudo_site 30"
## [25] "pseudo_site 4"  "pseudo_site 5"  "pseudo_site 6"  "pseudo_site 7" 
## [29] "pseudo_site 8"  "pseudo_site 9"</code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># episodes in the cleaned data table</span>
<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">tb</span><span class="op">$</span><span class="va">tclean</span><span class="op">$</span><span class="va">site</span>, <span class="va">tb</span><span class="op">$</span><span class="va">tclean</span><span class="op">$</span><span class="va">episode_id</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "pseudo_site 10" "pseudo_site 11" "pseudo_site 12" "pseudo_site 13"
##  [5] "pseudo_site 14" "pseudo_site 15" "pseudo_site 16" "pseudo_site 17"
##  [9] "pseudo_site 18" "pseudo_site 19" "pseudo_site 2"  "pseudo_site 20"
## [13] "pseudo_site 21" "pseudo_site 22" "pseudo_site 23" "pseudo_site 24"
## [17] "pseudo_site 25" "pseudo_site 26" "pseudo_site 27" "pseudo_site 28"
## [21] "pseudo_site 29" "pseudo_site 3"  "pseudo_site 30" "pseudo_site 4" 
## [25] "pseudo_site 5"  "pseudo_site 6"  "pseudo_site 7"  "pseudo_site 8" 
## [29] "pseudo_site 9"</code></pre>
</div>
<div id="nodata-filter" class="section level2">
<h2 class="hasAnchor">
<a href="#nodata-filter" class="anchor"></a>Nodata filter</h2>
<p>Similarly, we can setup the no data filter as following. Here it means, drop the entire episode if no hear rate data is found.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode yaml"><code class="sourceCode yaml"><a class="sourceLine" id="cb23-1" title="1"><span class="fu">NIHR_HIC_ICU_0108:</span></a>
<a class="sourceLine" id="cb23-2" title="2">  <span class="fu">shortName:</span><span class="at"> h_rate</span></a>
<a class="sourceLine" id="cb23-3" title="3">  <span class="fu">dataItem:</span><span class="at"> Heart rate</span></a>
<a class="sourceLine" id="cb23-4" title="4">  <span class="fu">no_data:</span></a>
<a class="sourceLine" id="cb23-5" title="5">    <span class="fu">apply:</span><span class="at"> drop_episode</span></a>
<a class="sourceLine" id="cb23-6" title="6"><span class="fu">NIHR_HIC_ICU_0112:</span></a>
<a class="sourceLine" id="cb23-7" title="7">  <span class="fu">shortName:</span><span class="at"> bp_sys_a</span></a>
<a class="sourceLine" id="cb23-8" title="8">  <span class="fu">dataItem:</span><span class="at"> Systolic Arterial blood pressure - Art BPSystolic Arterial blood pressure</span></a>
<a class="sourceLine" id="cb23-9" title="9"><span class="fu">NIHR_HIC_ICU_0093:</span></a>
<a class="sourceLine" id="cb23-10" title="10">   <span class="fu">shortName:</span><span class="at"> sex</span></a></code></pre></div>
</div>
<div id="run-all-filters-together" class="section level2">
<h2 class="hasAnchor">
<a href="#run-all-filters-together" class="anchor"></a>Run all filters together</h2>
<p>To wrap up, we can put all the above stated filter configurations together in the YAML file and run the filter together.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">conf</span> <span class="op">&lt;-</span> <span class="st">"NIHR_HIC_ICU_0108:
  shortName: h_rate
  dataItem: Heart rate
  range:
    labels:
      red: (0, 300)
      amber: (11, 150]
      green: (50, 100]
    apply: drop_entry
  missingness:
    labels:
      daily: 24
    accept_2d:
      daily: 70
    apply: drop_episode
  nodata:
    apply: drop_episode
NIHR_HIC_ICU_0112:
  shortName: bp_sys_a
  dataItem: Systolic Arterial blood pressure - Art BPSystolic Arterial blood pressure
NIHR_HIC_ICU_0093:
   shortName: sex
   category:
    levels:
      M: male
      F: female
      m: male
      f: female
    apply: drop_entry
"</span>
<span class="va">conf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/yaml/man/yaml.load.html">yaml.load</a></span><span class="op">(</span><span class="va">conf</span><span class="op">)</span>

<span class="co"># Method 1</span>
<span class="va">tb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_cctable.html">create_cctable</a></span><span class="op">(</span><span class="va">ccd</span>, <span class="va">conf</span>, freq<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="va">tb</span><span class="op">$</span><span class="fu">filter_range</span><span class="op">(</span><span class="st">"amber"</span><span class="op">)</span>
<span class="va">tb</span><span class="op">$</span><span class="fu">filter_missingness</span><span class="op">(</span><span class="op">)</span>
<span class="va">tb</span><span class="op">$</span><span class="fu">filter_nodata</span><span class="op">(</span><span class="op">)</span>
<span class="va">tb</span><span class="op">$</span><span class="fu">filter_categories</span><span class="op">(</span><span class="op">)</span>
<span class="va">tb</span><span class="op">$</span><span class="fu">apply_filters</span><span class="op">(</span><span class="op">)</span> 

<span class="va">tb</span><span class="op">$</span><span class="fu">reset</span><span class="op">(</span><span class="op">)</span> <span class="co"># reset</span>

<span class="co"># Method 2</span>
<span class="co">#tb$clean()</span></code></pre></div>
</div>
<div id="imputation" class="section level2">
<h2 class="hasAnchor">
<a href="#imputation" class="anchor"></a>Imputation</h2>
<p>We provide the <code>impute()</code> to interpolate the missing data. For each missing value, the interpolation will be only based on the nearby values which are specified by <code>lead</code> and <code>lag</code> arguments. <code>lead</code> suggests the number of previous values and <code>lag</code> suggests the number of later values. The corresponding time will be related to the <code>freq</code> you set for the <code>ccTable</code>, e.g. <code>lead: 2</code> means previous 4 hours when <code>freq=0.5</code>. One can also set the <code>fun</code> to determine the interpolation function. The imputation step usually should be carried out after filtering, otherwise imputation will take values that are out of range its into account.</p>
<p>One needs to be always careful when impute the data to make the best trade-off between usefulness and correctness. The interpolation methods should be carried out wisely based on the characteristics of the variable. A good overview of how to deal with the missing data can be found <a href="https://link.springer.com/content/pdf/10.1007%2F978-3-319-43742-2_13.pdf">(Salagodo et al. 2016)</a> If you are not sure about the characteristics of the variable, we would suggest you to keep the window size small and use <code>median</code> as the interpolation function.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Initialise the simulated ccRecord</span>
<span class="va">hr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">80</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">90</span>, <span class="fl">10</span><span class="op">)</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">90</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fl">180</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, 
        <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">90</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fl">180</span>, <span class="cn">NA</span>, <span class="fl">0</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="co"># hr &lt;- hr + runif(length(hr)) * 15 # adding noise if needed. </span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>time<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">hr</span><span class="op">)</span><span class="op">)</span>, item2d<span class="op">=</span><span class="va">hr</span><span class="op">)</span>
<span class="va">rec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ccRecord-class.html">ccRecord</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="../reference/new.episode.html">new.episode</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>NIHR_HIC_ICU_0108<span class="op">=</span><span class="va">data</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Prepare the plotting function</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com">data.table</a></span><span class="op">)</span>
<span class="va">plot_imputation</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
<span class="va">cptb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span>episode_id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">tb</span><span class="op">$</span><span class="va">torigin</span><span class="op">$</span><span class="va">episode_id</span><span class="op">)</span>, 
                   time<span class="op">=</span><span class="va">tb</span><span class="op">$</span><span class="va">torigin</span><span class="op">$</span><span class="va">time</span>, origin<span class="op">=</span><span class="va">tb</span><span class="op">$</span><span class="va">torigin</span><span class="op">$</span><span class="va">NIHR_HIC_ICU_0108</span>, 
                   clean<span class="op">=</span><span class="va">tb</span><span class="op">$</span><span class="va">tclean</span><span class="op">$</span><span class="va">NIHR_HIC_ICU_0108</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">cptb</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">5</span>, shape<span class="op">=</span><span class="fl">16</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">origin</span><span class="op">)</span>, colour<span class="op">=</span><span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">clean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">clean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>minor_breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">hr</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>colour<span class="op">=</span><span class="st">"grey"</span>, size<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span>, 
        panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>colour<span class="op">=</span><span class="st">"grey"</span>, size<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p><strong>Example 1</strong>: median interpolation with a window [-2, 2]</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># mock the configuration YAML</span>
<span class="va">conf</span> <span class="op">&lt;-</span> <span class="st">"NIHR_HIC_ICU_0108:
  shortName: h_rate
  dataItem: Heart rate
  missingness:
    impute:
      lead: 2 # 2 previous values 
      lag: 2  # 2 later values
      fun: median # missing value filled by the median of 2 previous and 2 later values. 
  nodata:
    apply: drop_episode
"</span>

<span class="va">conf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/yaml/man/yaml.load.html">yaml.load</a></span><span class="op">(</span><span class="va">conf</span><span class="op">)</span>
<span class="va">tb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_cctable.html">create_cctable</a></span><span class="op">(</span><span class="va">rec</span>, <span class="va">conf</span>, freq<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="va">tb</span><span class="op">$</span><span class="fu">imputation</span><span class="op">(</span><span class="op">)</span>
<span class="fu">plot_imputation</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="data_clean_files/figure-html/unnamed-chunk-16-1.png" width="700px"></p>
<p><strong>Example 2</strong>: increase the window size to [-10, 10] We can increase the window size to fill more data,</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">conf</span> <span class="op">&lt;-</span> <span class="st">"NIHR_HIC_ICU_0108:
  shortName: h_rate
  dataItem: Heart rate
  missingness:
    impute:
      lead: 10
      lag: 10
      fun: median
  nodata:
    apply: drop_episode
"</span>

<span class="va">rec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ccRecord-class.html">ccRecord</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="../reference/new.episode.html">new.episode</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>NIHR_HIC_ICU_0108<span class="op">=</span><span class="va">data</span><span class="op">)</span><span class="op">)</span>

<span class="va">conf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/yaml/man/yaml.load.html">yaml.load</a></span><span class="op">(</span><span class="va">conf</span><span class="op">)</span>
<span class="va">tb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_cctable.html">create_cctable</a></span><span class="op">(</span><span class="va">rec</span>, <span class="va">conf</span>, freq<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="va">tb</span><span class="op">$</span><span class="fu">imputation</span><span class="op">(</span><span class="op">)</span>
<span class="fu">plot_imputation</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="data_clean_files/figure-html/unnamed-chunk-17-1.png" width="700px"></p>
<p><strong>Example 3</strong>: use <code>mean</code> as the interpolation function.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">conf</span> <span class="op">&lt;-</span> <span class="st">"NIHR_HIC_ICU_0108:
  shortName: h_rate
  dataItem: Heart rate
  missingness:
    impute:
      lead: 10
      lag: 10
      fun: mean
  nodata:
    apply: drop_episode
"</span>

<span class="va">rec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ccRecord-class.html">ccRecord</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="../reference/new.episode.html">new.episode</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>NIHR_HIC_ICU_0108<span class="op">=</span><span class="va">data</span><span class="op">)</span><span class="op">)</span>

<span class="va">conf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/yaml/man/yaml.load.html">yaml.load</a></span><span class="op">(</span><span class="va">conf</span><span class="op">)</span>
<span class="va">tb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_cctable.html">create_cctable</a></span><span class="op">(</span><span class="va">rec</span>, <span class="va">conf</span>, freq<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="va">tb</span><span class="op">$</span><span class="fu">imputation</span><span class="op">(</span><span class="op">)</span>
<span class="fu">plot_imputation</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="data_clean_files/figure-html/unnamed-chunk-18-1.png" width="700px"></p>
<p><strong>Advanced Example</strong>: Use a self-defined function.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">conf</span> <span class="op">&lt;-</span> <span class="st">"NIHR_HIC_ICU_0108:
  shortName: h_rate
  dataItem: Heart rate
  missingness:
    impute:
      lead: 40
      lag: 40
      fun: myfun
  nodata:
    apply: drop_episode
"</span>
<span class="co"># Define my own interpolation function. </span>
<span class="co"># We use piecewise polynomial interpolation spline here for </span>
<span class="co"># the demonstration purpose. </span>
<span class="va">myfun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/splinefun.html">splinefun</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>


<span class="va">conf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/yaml/man/yaml.load.html">yaml.load</a></span><span class="op">(</span><span class="va">conf</span><span class="op">)</span>
<span class="va">tb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_cctable.html">create_cctable</a></span><span class="op">(</span><span class="va">rec</span>, <span class="va">conf</span>, freq<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="va">tb</span><span class="op">$</span><span class="fu">imputation</span><span class="op">(</span><span class="op">)</span>
<span class="fu">plot_imputation</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="data_clean_files/figure-html/unnamed-chunk-19-1.png" width="700px"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start bottom-8">
            <div class="col-xs-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-xs-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="http://github.com/ropensci" target="_blank"><div class="icon fab fa-github"></div></a>
                        <a href="http://github.com/ropenscilabs" target="_blank"><div class="icon fa fa-flask"></div></a>
                        <a href="http://twitter.com/ropensci" target="_blank"><div class="icon fab fa-twitter"></div></a>
                        <a href="http://vimeo.com/ropensci" target="_blank"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review">Software Review Process</a></li>
                            <li><a href="https://ropensci.org/about#team">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate">Donate</a></li>
                            <li><a href="https://ropensci.org/contact">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/">Documentation</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" target="_blank">NumFOCUS</a></p>
                        <a href="http://numfocus.org" target="_blank"></a>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '799829e946e1f0f9cd5b5a782c6316b9',
    indexName: 'ropensci-cleanehr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
